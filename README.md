# testrabbitmq-webgate1
1、委托挂单的系统延迟时间在10毫秒以内。撤单按用户分两种情况，机构或专业用户采用异步撤单机制，请求延迟在10毫秒以内直接返回受理结果，撤单结果需要机构用户自己主动查询。普通用户撤单，响应延迟在100毫秒内内，返回撤单是否成功。
2、撮合引擎支持一主多从，建议配置至少一主二从以上，撮合系统主从切换的时间不超过3秒。即使发生主撮合引擎宕机的极端情况时，不会影响用户的挂单、撤单、提现、转账等委托请求。但会影响行情、盘口数据的推送，延迟不超过3秒。
3、支持机构或专业用户的高频量化交易，下单首先经过基于Redis内存的账户记账，在撮合之前，账户资金变更与订单等不入库持久化，同时做到确保数据最终一致性。
4、基于本地内存进行流水线撮合，单笔撮合的时间开销10毫秒，根据不同选型，基于MQ的撮合引擎的吞吐量可以达到每秒5000笔，这里主要实现这种方案。（另一种架构会支持每秒10万，感兴趣的可以联系我）。
5、支持按币对配置不同的撮合引擎，网关启动初始化时加载币对配置信息，获取币对对应的撮合引擎交换机，将消息发送给指定的交换机。
6、撮合引擎在配置文件中定义交换机标识。
7、系统中的所有服务器，在配置文件中需要配置各自的区域ID和机器ID，同一个区域ID的机器ID不用重复，将基于此采用分布式算法生成订单ID，以及MQ队列名称。挂单的消息统一为广播类型，将发送给绑定该交换机的所有撮合引擎，每个撮合引擎有自己独立的消息队列，同一个交换机下的不同消息队列的内容完全一致。
8、挂单请求发送到网关，网关调用基于Redis的账户记账扣款后，将委托单发送到MQ，但只发送一次消息，如果发送失败了并不再重发，而是记录异常事件，等待定期做redis内存账户回滚操作。
9、撮合引擎完成一笔撮合后，首先进行行情数据的更新，只更新本地内存，由单独的同步进程定期每100毫秒刷新到Redis，再由接口适配器发布具体格式的数据推送到前端。
10、待行情数据更新本地完毕后，进行持久化入库。
11、待持久化入库完成后，发送撮合成交记录消息到MQ，供后续相关业务操作。例如后续可以扩展，向前端推送最近24小时成交记录，实现交易挖矿功能，以及发一些提示信息，将这些扩展业务与撮合系统解耦。



